import { __awaiter } from "tslib";
import { Subject } from 'rxjs';
import * as idb from 'idb';
import { OAUTH_INFO } from '../../providers/shared/oauth.provider';
import { EncryptionService } from '../security/encryption.service';
export class IndexedDBService {
    constructor(injector, dbname, version, storeName) {
        this.storeName = storeName;
        this.openSessionIDB(dbname, version);
        this.enc = injector.get(EncryptionService);
        this.oauthResource = injector.get(OAUTH_INFO);
    }
    openSessionIDB(dbname, version) {
        return __awaiter(this, void 0, void 0, function* () {
            return this.$dbPromise = idb.openDB(dbname, version);
        });
    }
    getAllOf() {
        const result$ = new Subject();
        this.getAllVal(this.storeName).then((value) => {
            result$.next(value);
        });
        return result$.asObservable();
    }
    getOf(key) {
        const result$ = new Subject();
        this.getKeyVal(key, this.storeName).then((value) => {
            result$.next(value);
        });
        return result$.asObservable();
    }
    putOf(key, val) {
        const result$ = new Subject();
        this.putKeyVal(key, val, this.storeName).then((value) => {
            result$.next(value);
        });
        return result$.asObservable();
    }
    removeOf(key) {
        const result$ = new Subject();
        this.removeKeyVal(key, this.storeName).then((value) => {
            result$.next(value);
        });
        return result$.asObservable();
    }
    getAll() {
        return this.getAllVal(this.storeName);
    }
    get(key) {
        return this.getKeyVal(this.storeName, key);
    }
    put(key, val) {
        return this.putKeyVal(this.storeName, key, val);
    }
    remove(key) {
        return this.removeKeyVal(this.storeName, key);
    }
    clearAll() {
        return this.clearAllKeyVal(this.storeName);
    }
    keys() {
        return this.keysKeyVal(this.storeName);
    }
    getAllVal(storeName) {
        return __awaiter(this, void 0, void 0, function* () {
            return (yield this.$dbPromise).getAll(storeName);
        });
    }
    getKeyVal(storeName, key) {
        return __awaiter(this, void 0, void 0, function* () {
            return (yield this.$dbPromise).get(storeName, key);
        });
    }
    putKeyVal(storeName, key, val) {
        return __awaiter(this, void 0, void 0, function* () {
            return (yield this.$dbPromise).put(storeName, val, key);
        });
    }
    removeKeyVal(storeName, key) {
        return __awaiter(this, void 0, void 0, function* () {
            return (yield this.$dbPromise).delete(storeName, key);
        });
    }
    clearAllKeyVal(storeName) {
        return __awaiter(this, void 0, void 0, function* () {
            return (yield this.$dbPromise).clear(storeName);
        });
    }
    keysKeyVal(storeName) {
        return __awaiter(this, void 0, void 0, function* () {
            return (yield this.$dbPromise).getAllKeys(storeName);
        });
    }
    addArticle(storeName, value) {
        return __awaiter(this, void 0, void 0, function* () {
            return (yield this.$dbPromise).add(storeName, value);
        });
    }
    addAllArticle(storeName, values) {
        return __awaiter(this, void 0, void 0, function* () {
            const tx = (yield this.$dbPromise).transaction(storeName, 'readwrite');
            values.forEach((value) => {
                tx.store.add(value);
            });
            return yield tx.done;
        });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXhlZC1kYi5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vQGRvbmdrYXAvZG8tY29yZS9zcmMvbGliL3NlcnZpY2VzL3N0b3JhZ2UvaW5kZXhlZC1kYi5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFDQSxPQUFPLEVBQWMsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBRTNDLE9BQU8sS0FBSyxHQUFHLE1BQU0sS0FBSyxDQUFDO0FBRTNCLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSx1Q0FBdUMsQ0FBQztBQUNuRSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUVuRSxNQUFNLE9BQU8sZ0JBQWdCO0lBSzNCLFlBQVksUUFBa0IsRUFBRSxNQUFjLEVBQUUsT0FBZSxFQUFVLFNBQWM7UUFBZCxjQUFTLEdBQVQsU0FBUyxDQUFLO1FBQ3JGLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBQ3JDLElBQUksQ0FBQyxHQUFHLEdBQUcsUUFBUSxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1FBQzNDLElBQUksQ0FBQyxhQUFhLEdBQUcsUUFBUSxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUNoRCxDQUFDO0lBRVksY0FBYyxDQUFDLE1BQWMsRUFBRSxPQUFlOztZQUN6RCxPQUFPLElBQUksQ0FBQyxVQUFVLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBSSxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFDMUQsQ0FBQztLQUFBO0lBRU0sUUFBUTtRQUNiLE1BQU0sT0FBTyxHQUFpQixJQUFJLE9BQU8sRUFBTyxDQUFDO1FBQ2pELElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLEtBQVUsRUFBRSxFQUFFO1lBQ2pELE9BQU8sQ0FBQyxJ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QzFELENBQUM7S0FBQTtJQUNZLFlBQVksQ0FBQyxTQUFjLEVBQUUsR0FBRzs7WUFDM0MsT0FBTyxDQUFDLE1BQU0sSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxTQUFTLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDeEQsQ0FBQztLQUFBO0lBQ1ksY0FBYyxDQUFDLFNBQWM7O1lBQ3hDLE9BQU8sQ0FBQyxNQUFNLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDbEQsQ0FBQztLQUFBO0lBQ1ksVUFBVSxDQUFDLFNBQWM7O1lBQ3BDLE9BQU8sQ0FBQyxNQUFNLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDdkQsQ0FBQztLQUFBO0lBRVksVUFBVSxDQUFDLFNBQWMsRUFBRSxLQUFVOztZQUM5QyxPQUFPLENBQUMsTUFBTSxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsR0FBRyxDQUFDLFNBQVMsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUN6RCxDQUFDO0tBQUE7SUFDWSxhQUFhLENBQUMsU0FBYyxFQUFFLE1BQWE7O1lBQ3BELE1BQU0sRUFBRSxHQUFHLENBQUMsTUFBTSxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsV0FBVyxDQUFDLFNBQVMsRUFBRSxXQUFXLENBQUMsQ0FBQztZQUN2RSxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsS0FBVSxFQUFFLEVBQUU7Z0JBQzFCLEVBQUUsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ3hCLENBQUMsQ0FBQyxDQUFDO1lBQ0gsT0FBTyxNQUFNLEVBQUUsQ0FBQyxJQUFJLENBQUM7UUFDekIsQ0FBQztLQUFBO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RvciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgSURCUERhdGFiYXNlLCBTdG9yZVZhbHVlLCBTdG9yZUtleSB9IGZyb20gJ2lkYic7XG5pbXBvcnQgKiBhcyBpZGIgZnJvbSAnaWRiJztcbmltcG9ydCB7IFNlY3VyaXR5UmVzb3VyY2VNb2RlbCB9IGZyb20gJy4uLy4uL21vZGVscyc7XG5pbXBvcnQgeyBPQVVUSF9JTkZPIH0gZnJvbSAnLi4vLi4vcHJvdmlkZXJzL3NoYXJlZC9vYXV0aC5wcm92aWRlcic7XG5pbXBvcnQgeyBFbmNyeXB0aW9uU2VydmljZSB9IGZyb20gJy4uL3NlY3VyaXR5L2VuY3J5cHRpb24uc2VydmljZSc7XG5cbmV4cG9ydCBjbGFzcyBJbmRleGVkREJTZXJ2aWNlPFQ+IHtcbiAgcHJvdGVjdGVkICRkYlByb21pc2U6IFByb21pc2U8SURCUERhdGFiYXNlPFQ+PjtcbiAgcHJvdGVjdGVkIGVuYzogRW5jcnlwdGlvblNlcnZpY2U7XG4gIHByb3RlY3RlZCBvYXV0aFJlc291cmNlOiBTZWN1cml0eVJlc291cmNlTW9kZWw7XG5cbiAgY29uc3RydWN0b3IoaW5qZWN0b3I6IEluamVjdG9yLCBkYm5hbWU6IHN0cmluZywgdmVyc2lvbjogbnVtYmVyLCBwcml2YXRlIHN0b3JlTmFtZTogYW55KSB7XG4gICAgdGhpcy5vcGVuU2Vzc2lvbklEQihkYm5hbWUsIHZlcnNpb24pO1xuICAgIHRoaXMuZW5jID0gaW5qZWN0b3IuZ2V0KEVuY3J5cHRpb25TZXJ2aWNlKTtcbiAgICB0aGlzLm9hdXRoUmVzb3VyY2UgPSBpbmplY3Rvci5nZXQoT0FVVEhfSU5GTyk7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgb3BlblNlc3Npb25JREIoZGJuYW1lOiBzdHJpbmcsIHZlcnNpb246IG51bWJlcik6IFByb21pc2U8SURCUERhdGFiYXNlPFQ+PiB7XG4gICAgcmV0dXJuIHRoaXMuJGRiUHJvbWlzZSA9IGlkYi5vcGVuREI8VD4oZGJuYW1lLCB2ZXJzaW9uKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRBbGxPZigpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgIGNvbnN0IHJlc3VsdCQ6IFN1YmplY3Q8YW55PiA9IG5ldyBTdWJqZWN0PGFueT4oKTtcbiAgICB0aGlzLmdldEFsbFZhbCh0aGlzLnN0b3JlTmFtZSkudGhlbigodmFsdWU6IGFueSkgPT4ge1xuICAgICAgcmVzdWx0JC5uZXh0KHZhbHVlKTtcbiAgICB9KTtcbiAgICByZXR1cm4gcmVzdWx0JC5hc09ic2VydmFibGUoKTtcbiAgfVxuICBwdWJsaWMgZ2V0T2Yoa2V5KTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICBjb25zdCByZXN1bHQkOiBTdWJqZWN0PGFueT4gPSBuZXcgU3ViamVjdDxhbnk+KCk7XG4gICAgdGhpcy5nZXRLZXlWYWwoa2V5LCB0aGlzLnN0b3JlTmFtZSkudGhlbigodmFsdWU6IGFueSkgPT4ge1xuICAgICAgcmVzdWx0JC5uZXh0KHZhbHVlKTtcbiAgICB9KTtcbiAgICByZXR1cm4gcmVzdWx0JC5hc09ic2VydmFibGUoKTtcbiAgfVxuICBwdWJsaWMgcHV0T2Yoa2V5LCB2YWwpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgIGNvbnN0IHJlc3VsdCQ6IFN1YmplY3Q8YW55PiA9IG5ldyBTdWJqZWN0PGFueT4oKTtcbiAgICB0aGlzLnB1dEtleVZhbChrZXksIHZhbCwgdGhpcy5zdG9yZU5hbWUpLnRoZW4oKHZhbHVlOiBhbnkpID0+IHtcbiAgICAgIHJlc3VsdCQubmV4dCh2YWx1ZSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIHJlc3VsdCQuYXNPYnNlcnZhYmxlKCk7XG4gIH1cbiAgcHVibGljIHJlbW92ZU9mKGtleSk6IE9ic2VydmFibGU8dm9pZD4ge1xuICAgIGNvbnN0IHJlc3VsdCQ6IFN1YmplY3Q8YW55PiA9IG5ldyBTdWJqZWN0PGFueT4oKTtcbiAgICB0aGlzLnJlbW92ZUtleVZhbChrZXksIHRoaXMuc3RvcmVOYW1lKS50aGVuKCh2YWx1ZTogYW55KSA9PiB7XG4gICAgICByZXN1bHQkLm5leHQodmFsdWUpO1xuICAgIH0pO1xuICAgIHJldHVybiByZXN1bHQkLmFzT2JzZXJ2YWJsZSgpO1xuICB9XG5cbiAgcHVibGljIGdldEFsbCgpOiBQcm9taXNlPFN0b3JlVmFsdWU8VCwgYW55PltdPiB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0QWxsVmFsKHRoaXMuc3RvcmVOYW1lKTtcbiAgfVxuICBwdWJsaWMgZ2V0KGtleSk6IFByb21pc2U8U3RvcmVWYWx1ZTxULCBhbnk+PiB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0S2V5VmFsKHRoaXMuc3RvcmVOYW1lLCBrZXkpO1xuICB9XG4gIHB1YmxpYyBwdXQoa2V5LCB2YWwpOiBQcm9taXNlPFN0b3JlS2V5PFQsIGFueT4+IHtcbiAgICByZXR1cm4gdGhpcy5wdXRLZXlWYWwodGhpcy5zdG9yZU5hbWUsIGtleSwgdmFsKTtcbiAgfVxuICBwdWJsaWMgcmVtb3ZlKGtleSk6IFByb21pc2U8dm9pZD4ge1xuICAgIHJldHVybiB0aGlzLnJlbW92ZUtleVZhbCh0aGlzLnN0b3JlTmFtZSwga2V5KTtcbiAgfVxuICBwdWJsaWMgY2xlYXJBbGwoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgcmV0dXJuIHRoaXMuY2xlYXJBbGxLZXlWYWwodGhpcy5zdG9yZU5hbWUpO1xuICB9XG4gIHB1YmxpYyBrZXlzKCk6IFByb21pc2U8U3RvcmVLZXk8VCwgYW55PltdPiB7XG4gICAgcmV0dXJuIHRoaXMua2V5c0tleVZhbCh0aGlzLnN0b3JlTmFtZSk7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgZ2V0QWxsVmFsKHN0b3JlTmFtZTogYW55KTogUHJvbWlzZTxTdG9yZVZhbHVlPFQsIGFueT5bXT4ge1xuICAgIHJldHVybiAoYXdhaXQgdGhpcy4kZGJQcm9taXNlKS5nZXRBbGwoc3RvcmVOYW1lKTtcbiAgfVxuICBwdWJsaWMgYXN5bmMgZ2V0S2V5VmFsKHN0b3JlTmFtZTogYW55LCBrZXkpOiBQcm9taXNlPFN0b3JlVmFsdWU8VCwgYW55Pj4ge1xuICAgIHJldHVybiAoYXdhaXQgdGhpcy4kZGJQcm9taXNlKS5nZXQoc3RvcmVOYW1lLCBrZXkpO1xuICB9XG4gIHB1YmxpYyBhc3luYyBwdXRLZXlWYWwoc3RvcmVOYW1lOiBhbnksIGtleSwgdmFsKTogUHJvbWlzZTxTdG9yZUtleTxULCBhbnk+PiB7XG4gICAgcmV0dXJuIChhd2FpdCB0aGlzLiRkYlByb21pc2UpLnB1dChzdG9yZU5hbWUsIHZhbCwga2V5KTtcbiAgfVxuICBwdWJsaWMgYXN5bmMgcmVtb3ZlS2V5VmFsKHN0b3JlTmFtZTogYW55LCBrZXkpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICByZXR1cm4gKGF3YWl0IHRoaXMuJGRiUHJvbWlzZSkuZGVsZXRlKHN0b3JlTmFtZSwga2V5KTtcbiAgfVxuICBwdWJsaWMgYXN5bmMgY2xlYXJBbGxLZXlWYWwoc3RvcmVOYW1lOiBhbnkpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICByZXR1cm4gKGF3YWl0IHRoaXMuJGRiUHJvbWlzZSkuY2xlYXIoc3RvcmVOYW1lKTtcbiAgfVxuICBwdWJsaWMgYXN5bmMga2V5c0tleVZhbChzdG9yZU5hbWU6IGFueSk6IFByb21pc2U8U3RvcmVLZXk8VCwgYW55PltdPiB7XG4gICAgcmV0dXJuIChhd2FpdCB0aGlzLiRkYlByb21pc2UpLmdldEFsbEtleXMoc3RvcmVOYW1lKTtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBhZGRBcnRpY2xlKHN0b3JlTmFtZTogYW55LCB2YWx1ZTogYW55KTogUHJvbWlzZTxTdG9yZUtleTxULCBhbnk+PiB7XG4gICAgICByZXR1cm4gKGF3YWl0IHRoaXMuJGRiUHJvbWlzZSkuYWRkKHN0b3JlTmFtZSwgdmFsdWUpO1xuICB9XG4gIHB1YmxpYyBhc3luYyBhZGRBbGxBcnRpY2xlKHN0b3JlTmFtZTogYW55LCB2YWx1ZXM6IGFueVtdKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICBjb25zdCB0eCA9IChhd2FpdCB0aGlzLiRkYlByb21pc2UpLnRyYW5zYWN0aW9uKHN0b3JlTmFtZSwgJ3JlYWR3cml0ZScpO1xuICAgICAgdmFsdWVzLmZvckVhY2goKHZhbHVlOiBhbnkpID0+IHtcbiAgICAgICAgICB0eC5zdG9yZS5hZGQodmFsdWUpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gYXdhaXQgdHguZG9uZTtcbiAgfVxufVxuIl19