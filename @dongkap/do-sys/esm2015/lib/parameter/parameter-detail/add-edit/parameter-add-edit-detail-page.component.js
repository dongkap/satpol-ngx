import { Component } from '@angular/core';
import { FormControl } from '@angular/forms';
import { takeUntil } from 'rxjs/operators';
import { ResponseCode, LocaleModel } from '@dongkap/do-core';
import { BaseFormComponent } from '@dongkap/do-shared';
import { ParameterModel, ParameterGroupModel } from '../../models/parameter.model';
import * as i0 from "@angular/core";
import * as i1 from "@angular/router";
import * as i2 from "../../services/parameter.service";
import * as i3 from "@dongkap/do-shared";
import * as i4 from "@angular/forms";
import * as i5 from "@angular/common";
import * as i6 from "@ngx-translate/core";
export class ParameterAddEditDetailPageComponent extends BaseFormComponent {
    constructor(injector, router, parameterService, route) {
        super(injector, {
            parameterCode: [],
            'en-US': [],
            'id-ID': [],
        });
        this.injector = injector;
        this.router = router;
        this.parameterService = parameterService;
        this.route = route;
        this.action = 'Add';
        this.parameter = new ParameterModel();
        this.parameterGroup = new ParameterGroupModel();
        this.allLocales = [];
        this.locales = [];
        this.localeDefault = new LocaleModel();
        this.isEdit = false;
        if (this.parameterService.getParameterGroup()) {
            this.parameterGroup = this.parameterService.getParameterGroup();
            if ((this.route.snapshot.params['action'] === 'edit')) {
                if (this.parameterService.getParameter()) {
                    this.action = 'Edit';
                    this.isEdit = true;
                    this.parameter = this.parameterService.getParameter();
                }
                else {
                    this.router.navigate(['/app/sysconf/parameter']);
                }
            }
            if (!this.parameterService.getLocales()) {
                this.apiPathLocale = this.api['master']['all-locale'];
                this.http.HTTP_AUTH(this.apiPathLocale).subscribe(response => {
                    this.parameterService.setLocales(response);
                    this.splitLocale(response);
                });
            }
            else {
                this.splitLocale(this.parameterService.getLocales());
            }
            if (this.isEdit) {
                this.formGroup.get('parameterCode').setValue(this.parameter.parameterCode);
                this.formGroup.get('parameterCode').disable({ emitEvent: true });
                this.apiPathParameterI18n = this.api['master']['all-parameter-i18n'];
                this.loadingForm = true;
                this.http.HTTP_AUTH(this.apiPathParameterI18n, {
                    parameterCode: this.parameter.parameterCode,
                }).subscribe((response) => {
                    response.forEach(data => {
                        this.formGroup.get(data.locale).setValue(data.parameterValue);
                        this.loadingForm = false;
                    });
                });
            }
        }
        else {
            this.router.navigate(['/app/sysconf/parameter']);
        }
    }
    splitLocale(values) {
        this.allLocales = values;
        values.forEach(data => {
            if (data.localeDefault) {
                this.localeDefault = data;
            }
            else {
                this.locales.push(data);
            }
            this.formGroup.removeControl(data.localeCode);
            this.formGroup.addControl(data.localeCode, new FormControl());
        });
    }
    ngOnInit() { }
    onReset() {
        this.router.navigate(['/app/sysconf/parameter/detail']);
    }
    onSubmit() {
        const data = this.formGroup.value;
        if (this.isEdit) {
            data.parameterCode = this.parameter.parameterCode;
        }
        data.parameterGroupCode = this.parameterGroup.parameterGroupCode;
        data.parameterValues = {};
        this.allLocales.forEach(value => {
            data.parameterValues[value.localeCode] = this.formGroup.get(value.localeCode).value;
        });
        super.onSubmit(data, 'master', 'post-parameter-i18n')
            .pipe(takeUntil(this.destroy$))
            .subscribe(response => {
            if (response.respStatusCode === ResponseCode.OK_SCR009.toString()) {
                this.router.navigate(['/app/sysconf/parameter/detail']);
            }
        });
    }
}
ParameterAddEditDetailPageComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: ParameterAddEditDetailPageComponent, deps: [{ token: i0.Injector }, { token: i1.Router }, { token: i2.ParameterService }, { token: i1.ActivatedRoute }], target: i0.ɵɵFactoryTarget.Component });
ParameterAddEditDetailPageComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.16", type: ParameterAddEditDetailPageComponent, selector: "do-parameter-add-edit-detail-page", usesInheritance: true, ngImport: i0, template: "<do-page-outlet [header]=\"action + ' Parameter'\" [url]=\"'/app/sysconf/parameter/detail'\">\n  <div class=\"row\" pagecontent>\n    <div class=\"col-md-12 col-lg-12\">\n      <form [formGroup]=\"formGroup\">\n        <do-input-text\n          [name]=\"'parameterCode'\"\n          [label]=\"'Parameter Code'\"\n          [required]=\"!isEdit\"\n          [skeleton]=\"loadingForm\"\n          formControlName=\"parameterCode\">\n        </do-input-text>\n        <div class=\"form-group row\">\n          <label\n            for=\"Parameter Value\"\n            class=\"label col-sm-3 col-form-label\"\n            *ngIf=\"!loadingForm; else labelskeleton\">\n            {{'Parameter Value' | translate}}\n          </label>\n          <ng-template #labelskeleton>\n            <div class=\"col-sm-3\">\n              <div\n                [ngClass]=\"{\n                  'label-skeleton': true,\n                  'skeleton': loadingForm\n                }\">\n              </div>\n            </div>\n          </ng-template>\n          <div class=\"col-sm-9\">\n            <do-input-icon *ngIf=\"localeDefault.localeCode\"\n              [name]=\"localeDefault.localeCode\"\n              [nolabel]=\"true\"\n              [required]=\"true\"\n              [colLabel]=\"0\"\n              [colInput]=\"12\"\n              [icon]=\"'flag-icon flag-icon-' + localeDefault.icon\"\n              [skeleton]=\"loadingForm\"\n              formControlName=\"{{localeDefault.localeCode}}\">\n            </do-input-icon>\n          </div>\n        </div>\n        <do-input-icon *ngFor=\"let i18n of locales\"\n          [name]=\"i18n.localeCode\"\n          [nolabel]=\"true\"\n          [icon]=\"'flag-icon flag-icon-'+ i18n.icon\"\n          [skeleton]=\"loadingForm\"\n          formControlName=\"{{i18n.localeCode}}\">\n        </do-input-icon>\n      </form>\n    </div>\n  </div>\n  <do-button-submit\n    [submitTitle]=\"action\"\n    [resetTitle]=\"'Cancel'\"\n    [formGroupButton]=\"formGroup\"\n    [disabledButton]=\"disabled\"\n    (onReset)=\"onReset()\"\n    (onSubmit)=\"onSubmit()\"\n    pagefooter>\n  </do-button-submit>\n</do-page-outlet>\n", styles: [".reset-left{margin-right:.25rem}.submit-right{margin-left:.25rem}\n"], components: [{ type: i3.DoPageOutletComponent, selector: "do-page-outlet", inputs: ["header", "url", "width", "dataSelect", "selected", "param", "hidefooter", "showToggle", "isCollapsed", "iconToggle"], outputs: ["selectChange", "onCollapsed", "onExpanded"] }, { type: i3.DoInputTextComponent, selector: "do-input-text", inputs: ["placeholder", "colLabel", "colInput", "minLength", "maxLength", "min", "max", "step", "capslock", "type"] }, { type: i3.DoInputIconComponent, selector: "do-input-icon", inputs: ["placeholder", "colLabel", "colInput", "minLength", "maxLength", "buttontype", "type", "iconcursor", "eva", "icon"], outputs: ["clickIcon", "focus"] }, { type: i3.DoButtonSubmitComponent, selector: "do-button-submit", inputs: ["colLabel", "colButton", "resetTitle", "submitTitle", "disabledButton", "disabledReset", "type", "status", "skeleton", "formGroupButton"], outputs: ["onSubmit", "onReset"] }], directives: [{ type: i4.ɵNgNoValidate, selector: "form:not([ngNoForm]):not([ngNativeValidate])" }, { type: i4.NgControlStatusGroup, selector: "[formGroupName],[formArrayName],[ngModelGroup],[formGroup],form:not([ngNoForm]),[ngForm]" }, { type: i4.FormGroupDirective, selector: "[formGroup]", inputs: ["formGroup"], outputs: ["ngSubmit"], exportAs: ["ngForm"] }, { type: i4.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { type: i4.FormControlName, selector: "[formControlName]", inputs: ["disabled", "formControlName", "ngModel"], outputs: ["ngModelChange"] }, { type: i4.RequiredValidator, selector: ":not([type=checkbox])[required][formControlName],:not([type=checkbox])[required][formControl],:not([type=checkbox])[required][ngModel]", inputs: ["required"] }, { type: i5.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i5.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { type: i5.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }], pipes: { "translate": i6.TranslatePipe } });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: ParameterAddEditDetailPageComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'do-parameter-add-edit-detail-page',
                    styleUrls: ['./parameter-add-edit-detail-page.component.scss'],
                    templateUrl: './parameter-add-edit-detail-page.component.html',
                }]
        }], ctorParameters: function () { return [{ type: i0.Injector }, { type: i1.Router }, { type: i2.ParameterService }, { type: i1.ActivatedRoute }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFyYW1ldGVyLWFkZC1lZGl0LWRldGFpbC1wYWdlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL0Bkb25na2FwL2RvLXN5cy9zcmMvbGliL3BhcmFtZXRlci9wYXJhbWV0ZXItZGV0YWlsL2FkZC1lZGl0L3BhcmFtZXRlci1hZGQtZWRpdC1kZXRhaWwtcGFnZS5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9AZG9uZ2thcC9kby1zeXMvc3JjL2xpYi9wYXJhbWV0ZXIvcGFyYW1ldGVyLWRldGFpbC9hZGQtZWRpdC9wYXJhbWV0ZXItYWRkLWVkaXQtZGV0YWlsLXBhZ2UuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBWSxNQUFNLGVBQWUsQ0FBQztBQUdwRCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFN0MsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzNDLE9BQU8sRUFBa0MsWUFBWSxFQUFFLFdBQVcsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQzdGLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBRXZELE9BQU8sRUFBRSxjQUFjLEVBQXNCLG1CQUFtQixFQUFFLE1BQU0sOEJBQThCLENBQUM7Ozs7Ozs7O0FBT3ZHLE1BQU0sT0FBTyxtQ0FBb0MsU0FBUSxpQkFBc0I7SUFZN0UsWUFDUyxRQUFrQixFQUNqQixNQUFjLEVBQ2QsZ0JBQWtDLEVBQ2xDLEtBQXFCO1FBQzdCLEtBQUssQ0FBQyxRQUFRLEVBQUU7WUFDZCxhQUFhLEVBQUUsRUFBRTtZQUNqQixPQUFPLEVBQUUsRUFBRTtZQUNYLE9BQU8sRUFBRSxFQUFFO1NBQ1osQ0FBQyxDQUFDO1FBUkksYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUNqQixXQUFNLEdBQU4sTUFB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LENBQUM7UUFDakUsSUFBSSxDQUFDLGVBQWUsR0FBRyxFQUFFLENBQUM7UUFDMUIsSUFBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDOUIsSUFBSSxDQUFDLGVBQWUsQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFDLEtBQUssQ0FBQztRQUN0RixDQUFDLENBQUMsQ0FBQztRQUNGLEtBQUssQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLFFBQVEsRUFBRSxxQkFBcUIsQ0FBa0M7YUFDcEYsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7YUFDOUIsU0FBUyxDQUFDLFFBQVEsQ0FBQyxFQUFFO1lBQ3BCLElBQUksUUFBUSxDQUFDLGNBQWMsS0FBSyxZQUFZLENBQUMsU0FBUyxDQUFDLFFBQVEsRUFBRSxFQUFFO2dCQUNqRSxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLCtCQUErQixDQUFDLENBQUMsQ0FBQzthQUN6RDtRQUNILENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQzs7aUlBakdVLG1DQUFtQztxSEFBbkMsbUNBQW1DLGdHQ2hCaEQsc25FQTZEQTs0RkQ3Q2EsbUNBQW1DO2tCQUwvQyxTQUFTO21CQUFDO29CQUNULFFBQVEsRUFBRSxtQ0FBbUM7b0JBQzdDLFNBQVMsRUFBRSxDQUFDLGlEQUFpRCxDQUFDO29CQUM5RCxXQUFXLEVBQUUsaURBQWlEO2lCQUMvRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgSW5qZWN0b3IgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE9uSW5pdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgUm91dGVyLCBBY3RpdmF0ZWRSb3V0ZSB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQgeyBGb3JtQ29udHJvbCB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IHRha2VVbnRpbCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IEh0dHBCYXNlTW9kZWwsIEFwaUJhc2VSZXNwb25zZSwgUmVzcG9uc2VDb2RlLCBMb2NhbGVNb2RlbCB9IGZyb20gJ0Bkb25na2FwL2RvLWNvcmUnO1xuaW1wb3J0IHsgQmFzZUZvcm1Db21wb25lbnQgfSBmcm9tICdAZG9uZ2thcC9kby1zaGFyZWQnO1xuaW1wb3J0IHsgUGFyYW1ldGVyU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3BhcmFtZXRlci5zZXJ2aWNlJztcbmltcG9ydCB7IFBhcmFtZXRlck1vZGVsLCBQYXJhbWV0ZXJJMThuTW9kZWwsIFBhcmFtZXRlckdyb3VwTW9kZWwgfSBmcm9tICcuLi8uLi9tb2RlbHMvcGFyYW1ldGVyLm1vZGVsJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnZG8tcGFyYW1ldGVyLWFkZC1lZGl0LWRldGFpbC1wYWdlJyxcbiAgc3R5bGVVcmxzOiBbJy4vcGFyYW1ldGVyLWFkZC1lZGl0LWRldGFpbC1wYWdlLmNvbXBvbmVudC5zY3NzJ10sXG4gIHRlbXBsYXRlVXJsOiAnLi9wYXJhbWV0ZXItYWRkLWVkaXQtZGV0YWlsLXBhZ2UuY29tcG9uZW50Lmh0bWwnLFxufSlcbmV4cG9ydCBjbGFzcyBQYXJhbWV0ZXJBZGRFZGl0RGV0YWlsUGFnZUNvbXBvbmVudCBleHRlbmRzIEJhc2VGb3JtQ29tcG9uZW50PGFueT4gaW1wbGVtZW50cyBPbkluaXQge1xuXG4gIHB1YmxpYyBhY3Rpb246ICdBZGQnIHwgJ0VkaXQnID0gJ0FkZCc7XG4gIHB1YmxpYyBwYXJhbWV0ZXI6IFBhcmFtZXRlck1vZGVsID0gbmV3IFBhcmFtZXRlck1vZGVsKCk7XG4gIHB1YmxpYyBwYXJhbWV0ZXJHcm91cDogUGFyYW1ldGVyR3JvdXBNb2RlbCA9IG5ldyBQYXJhbWV0ZXJHcm91cE1vZGVsKCk7XG4gIHB1YmxpYyBhbGxMb2NhbGVzOiBMb2NhbGVNb2RlbFtdID0gW107XG4gIHB1YmxpYyBsb2NhbGVzOiBMb2NhbGVNb2RlbFtdID0gW107XG4gIHB1YmxpYyBsb2NhbGVEZWZhdWx0OiBMb2NhbGVNb2RlbCA9IG5ldyBMb2NhbGVNb2RlbCgpO1xuICBwdWJsaWMgaXNFZGl0OiBib29sZWFuID0gZmFsc2U7XG4gIHB1YmxpYyBhcGlQYXRoUGFyYW1ldGVySTE4bjogSHR0cEJhc2VNb2RlbDtcbiAgcHVibGljIGFwaVBhdGhMb2NhbGU6IEh0dHBCYXNlTW9kZWw7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHVibGljIGluamVjdG9yOiBJbmplY3RvcixcbiAgICBwcml2YXRlIHJvdXRlcjogUm91dGVyLFxuICAgIHByaXZhdGUgcGFyYW1ldGVyU2VydmljZTogUGFyYW1ldGVyU2VydmljZSxcbiAgICBwcml2YXRlIHJvdXRlOiBBY3RpdmF0ZWRSb3V0ZSkge1xuICAgIHN1cGVyKGluamVjdG9yLCB7XG4gICAgICBwYXJhbWV0ZXJDb2RlOiBbXSxcbiAgICAgICdlbi1VUyc6IFtdLFxuICAgICAgJ2lkLUlEJzogW10sXG4gICAgfSk7XG4gICAgaWYgKHRoaXMucGFyYW1ldGVyU2VydmljZS5nZXRQYXJhbWV0ZXJHcm91cCgpKSB7XG4gICAgICB0aGlzLnBhcmFtZXRlckdyb3VwID0gdGhpcy5wYXJhbWV0ZXJTZXJ2aWNlLmdldFBhcmFtZXRlckdyb3VwKCk7XG4gICAgICBpZiAoKHRoaXMucm91dGUuc25hcHNob3QucGFyYW1zWydhY3Rpb24nXSA9PT0gJ2VkaXQnKSkge1xuICAgICAgICBpZiAodGhpcy5wYXJhbWV0ZXJTZXJ2aWNlLmdldFBhcmFtZXRlcigpKSB7XG4gICAgICAgICAgdGhpcy5hY3Rpb24gPSAnRWRpdCc7XG4gICAgICAgICAgdGhpcy5pc0VkaXQgPSB0cnVlO1xuICAgICAgICAgIHRoaXMucGFyYW1ldGVyID0gdGhpcy5wYXJhbWV0ZXJTZXJ2aWNlLmdldFBhcmFtZXRlcigpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMucm91dGVyLm5hdmlnYXRlKFsnL2FwcC9zeXNjb25mL3BhcmFtZXRlciddKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKCF0aGlzLnBhcmFtZXRlclNlcnZpY2UuZ2V0TG9jYWxlcygpKSB7XG4gICAgICAgIHRoaXMuYXBpUGF0aExvY2FsZSA9IHRoaXMuYXBpWydtYXN0ZXInXVsnYWxsLWxvY2FsZSddO1xuICAgICAgICB0aGlzLmh0dHAuSFRUUF9BVVRIKHRoaXMuYXBpUGF0aExvY2FsZSkuc3Vic2NyaWJlKHJlc3BvbnNlID0+IHtcbiAgICAgICAgICB0aGlzLnBhcmFtZXRlclNlcnZpY2Uuc2V0TG9jYWxlcyhyZXNwb25zZSk7XG4gICAgICAgICAgdGhpcy5zcGxpdExvY2FsZShyZXNwb25zZSk7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5zcGxpdExvY2FsZSh0aGlzLnBhcmFtZXRlclNlcnZpY2UuZ2V0TG9jYWxlcygpKTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmlzRWRpdCkge1xuICAgICAgICB0aGlzLmZvcm1Hcm91cC5nZXQoJ3BhcmFtZXRlckNvZGUnKS5zZXRWYWx1ZSh0aGlzLnBhcmFtZXRlci5wYXJhbWV0ZXJDb2RlKTtcbiAgICAgICAgdGhpcy5mb3JtR3JvdXAuZ2V0KCdwYXJhbWV0ZXJDb2RlJykuZGlzYWJsZSh7ZW1pdEV2ZW50OiB0cnVlfSk7XG4gICAgICAgIHRoaXMuYXBpUGF0aFBhcmFtZXRlckkxOG4gPSB0aGlzLmFwaVsnbWFzdGVyJ11bJ2FsbC1wYXJhbWV0ZXItaTE4biddO1xuICAgICAgICB0aGlzLmxvYWRpbmdGb3JtID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5odHRwLkhUVFBfQVVUSCh0aGlzLmFwaVBhdGhQYXJhbWV0ZXJJMThuLCB7XG4gICAgICAgICAgcGFyYW1ldGVyQ29kZTogdGhpcy5wYXJhbWV0ZXIucGFyYW1ldGVyQ29kZSxcbiAgICAgICAgfSkuc3Vic2NyaWJlKChyZXNwb25zZTogUGFyYW1ldGVySTE4bk1vZGVsW10pID0+IHtcbiAgICAgICAgICByZXNwb25zZS5mb3JFYWNoKGRhdGEgPT4ge1xuICAgICAgICAgICAgdGhpcy5mb3JtR3JvdXAuZ2V0KGRhdGEubG9jYWxlKS5zZXRWYWx1ZShkYXRhLnBhcmFtZXRlclZhbHVlKTtcbiAgICAgICAgICAgIHRoaXMubG9hZGluZ0Zvcm0gPSBmYWxzZTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucm91dGVyLm5hdmlnYXRlKFsnL2FwcC9zeXNjb25mL3BhcmFtZXRlciddKTtcbiAgICB9XG4gIH1cblxuICBzcGxpdExvY2FsZSh2YWx1ZXM6IExvY2FsZU1vZGVsW10pOiB2b2lkIHtcbiAgICB0aGlzLmFsbExvY2FsZXMgPSB2YWx1ZXM7XG4gICAgdmFsdWVzLmZvckVhY2goZGF0YSA9PiB7XG4gICAgICBpZiAoZGF0YS5sb2NhbGVEZWZhdWx0KSB7XG4gICAgICAgIHRoaXMubG9jYWxlRGVmYXVsdCA9IGRhdGE7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmxvY2FsZXMucHVzaChkYXRhKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuZm9ybUdyb3VwLnJlbW92ZUNvbnRyb2woZGF0YS5sb2NhbGVDb2RlKTtcbiAgICAgIHRoaXMuZm9ybUdyb3VwLmFkZENvbnRyb2woZGF0YS5sb2NhbGVDb2RlLCBuZXcgRm9ybUNvbnRyb2woKSk7XG4gICAgfSk7XG4gIH1cblxuICBuZ09uSW5pdCgpOiB2b2lkIHt9XG5cbiAgb25SZXNldCgpOiB2b2lkIHtcbiAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZShbJy9hcHAvc3lzY29uZi9wYXJhbWV0ZXIvZGV0YWlsJ10pO1xuICB9XG5cbiAgb25TdWJtaXQoKSB7XG4gICAgY29uc3QgZGF0YTogYW55ID0gdGhpcy5mb3JtR3JvdXAudmFsdWU7XG4gICAgaWYgKHRoaXMuaXNFZGl0KSB7XG4gICAgICBkYXRhLnBhcmFtZXRlckNvZGUgPSB0aGlzLnBhcmFtZXRlci5wYXJhbWV0ZXJDb2RlO1xuICAgIH1cbiAgICBkYXRhLnBhcmFtZXRlckdyb3VwQ29kZSA9IHRoaXMucGFyYW1ldGVyR3JvdXAucGFyYW1ldGVyR3JvdXBDb2RlO1xuICAgIGRhdGEucGFyYW1ldGVyVmFsdWVzID0ge307XG4gICAgdGhpcy5hbGxMb2NhbGVzLmZvckVhY2godmFsdWUgPT4ge1xuICAgICAgZGF0YS5wYXJhbWV0ZXJWYWx1ZXNbdmFsdWUubG9jYWxlQ29kZV0gPSB0aGlzLmZvcm1Hcm91cC5nZXQodmFsdWUubG9jYWxlQ29kZSkudmFsdWU7XG4gICAgfSk7XG4gICAgKHN1cGVyLm9uU3VibWl0KGRhdGEsICdtYXN0ZXInLCAncG9zdC1wYXJhbWV0ZXItaTE4bicpICBhcyBPYnNlcnZhYmxlPEFwaUJhc2VSZXNwb25zZT4pXG4gICAgICAucGlwZSh0YWtlVW50aWwodGhpcy5kZXN0cm95JCkpXG4gICAgICAuc3Vic2NyaWJlKHJlc3BvbnNlID0+IHtcbiAgICAgICAgaWYgKHJlc3BvbnNlLnJlc3BTdGF0dXNDb2RlID09PSBSZXNwb25zZUNvZGUuT0tfU0NSMDA5LnRvU3RyaW5nKCkpIHtcbiAgICAgICAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZShbJy9hcHAvc3lzY29uZi9wYXJhbWV0ZXIvZGV0YWlsJ10pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgfVxuXG59XG4iLCI8ZG8tcGFnZS1vdXRsZXQgW2hlYWRlcl09XCJhY3Rpb24gKyAnIFBhcmFtZXRlcidcIiBbdXJsXT1cIicvYXBwL3N5c2NvbmYvcGFyYW1ldGVyL2RldGFpbCdcIj5cbiAgPGRpdiBjbGFzcz1cInJvd1wiIHBhZ2Vjb250ZW50PlxuICAgIDxkaXYgY2xhc3M9XCJjb2wtbWQtMTIgY29sLWxnLTEyXCI+XG4gICAgICA8Zm9ybSBbZm9ybUdyb3VwXT1cImZvcm1Hcm91cFwiPlxuICAgICAgICA8ZG8taW5wdXQtdGV4dFxuICAgICAgICAgIFtuYW1lXT1cIidwYXJhbWV0ZXJDb2RlJ1wiXG4gICAgICAgICAgW2xhYmVsXT1cIidQYXJhbWV0ZXIgQ29kZSdcIlxuICAgICAgICAgIFtyZXF1aXJlZF09XCIhaXNFZGl0XCJcbiAgICAgICAgICBbc2tlbGV0b25dPVwibG9hZGluZ0Zvcm1cIlxuICAgICAgICAgIGZvcm1Db250cm9sTmFtZT1cInBhcmFtZXRlckNvZGVcIj5cbiAgICAgICAgPC9kby1pbnB1dC10ZXh0PlxuICAgICAgICA8ZGl2IGNsYXNzPVwiZm9ybS1ncm91cCByb3dcIj5cbiAgICAgICAgICA8bGFiZWxcbiAgICAgICAgICAgIGZvcj1cIlBhcmFtZXRlciBWYWx1ZVwiXG4gICAgICAgICAgICBjbGFzcz1cImxhYmVsIGNvbC1zbS0zIGNvbC1mb3JtLWxhYmVsXCJcbiAgICAgICAgICAgICpuZ0lmPVwiIWxvYWRpbmdGb3JtOyBlbHNlIGxhYmVsc2tlbGV0b25cIj5cbiAgICAgICAgICAgIHt7J1BhcmFtZXRlciBWYWx1ZScgfCB0cmFuc2xhdGV9fVxuICAgICAgICAgIDwvbGFiZWw+XG4gICAgICAgICAgPG5nLXRlbXBsYXRlICNsYWJlbHNrZWxldG9uPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNvbC1zbS0zXCI+XG4gICAgICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgICAgICBbbmdDbGFzc109XCJ7XG4gICAgICAgICAgICAgICAgICAnbGFiZWwtc2tlbGV0b24nOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgJ3NrZWxldG9uJzogbG9hZGluZ0Zvcm1cbiAgICAgICAgICAgICAgICB9XCI+XG4gICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPC9uZy10ZW1wbGF0ZT5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29sLXNtLTlcIj5cbiAgICAgICAgICAgIDxkby1pbnB1dC1pY29uICpuZ0lmPVwibG9jYWxlRGVmYXVsdC5sb2NhbGVDb2RlXCJcbiAgICAgICAgICAgICAgW25hbWVdPVwibG9jYWxlRGVmYXVsdC5sb2NhbGVDb2RlXCJcbiAgICAgICAgICAgICAgW25vbGFiZWxdPVwidHJ1ZVwiXG4gICAgICAgICAgICAgIFtyZXF1aXJlZF09XCJ0cnVlXCJcbiAgICAgICAgICAgICAgW2NvbExhYmVsXT1cIjBcIlxuICAgICAgICAgICAgICBbY29sSW5wdXRdPVwiMTJcIlxuICAgICAgICAgICAgICBbaWNvbl09XCInZmxhZy1pY29uIGZsYWctaWNvbi0nICsgbG9jYWxlRGVmYXVsdC5pY29uXCJcbiAgICAgICAgICAgICAgW3NrZWxldG9uXT1cImxvYWRpbmdGb3JtXCJcbiAgICAgICAgICAgICAgZm9ybUNvbnRyb2xOYW1lPVwie3tsb2NhbGVEZWZhdWx0LmxvY2FsZUNvZGV9fVwiPlxuICAgICAgICAgICAgPC9kby1pbnB1dC1pY29uPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRvLWlucHV0LWljb24gKm5nRm9yPVwibGV0IGkxOG4gb2YgbG9jYWxlc1wiXG4gICAgICAgICAgW25hbWVdPVwiaTE4bi5sb2NhbGVDb2RlXCJcbiAgICAgICAgICBbbm9sYWJlbF09XCJ0cnVlXCJcbiAgICAgICAgICBbaWNvbl09XCInZmxhZy1pY29uIGZsYWctaWNvbi0nKyBpMThuLmljb25cIlxuICAgICAgICAgIFtza2VsZXRvbl09XCJsb2FkaW5nRm9ybVwiXG4gICAgICAgICAgZm9ybUNvbnRyb2xOYW1lPVwie3tpMThuLmxvY2FsZUNvZGV9fVwiPlxuICAgICAgICA8L2RvLWlucHV0LWljb24+XG4gICAgICA8L2Zvcm0+XG4gICAgPC9kaXY+XG4gIDwvZGl2PlxuICA8ZG8tYnV0dG9uLXN1Ym1pdFxuICAgIFtzdWJtaXRUaXRsZV09XCJhY3Rpb25cIlxuICAgIFtyZXNldFRpdGxlXT1cIidDYW5jZWwnXCJcbiAgICBbZm9ybUdyb3VwQnV0dG9uXT1cImZvcm1Hcm91cFwiXG4gICAgW2Rpc2FibGVkQnV0dG9uXT1cImRpc2FibGVkXCJcbiAgICAob25SZXNldCk9XCJvblJlc2V0KClcIlxuICAgIChvblN1Ym1pdCk9XCJvblN1Ym1pdCgpXCJcbiAgICBwYWdlZm9vdGVyPlxuICA8L2RvLWJ1dHRvbi1zdWJtaXQ+XG48L2RvLXBhZ2Utb3V0bGV0PlxuIl19